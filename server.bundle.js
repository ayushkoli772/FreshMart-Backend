(()=>{var e={5724:e=>{e.exports={user:"shop9",password:"Ue89LSAHe!8?",database:"shop9",server:"den1.mssql8.gear.host",pool:{max:10,min:0,idleTimeoutMillis:3e4},options:{encrypt:!1,trustServerCertificate:!0}}},957:(e,t,r)=>{var o=r(6860).Router(),s=r(8945);o.route("/:id?").get(s.getCart),o.route("/").post(s.newCartitem),o.route("/:id").delete(s.deleteCartitem),e.exports=o},8945:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185),n=r(8904),i=r(5656);e.exports={getCart:async(e,t)=>{console.log("getCart id:"+e.params.id);const r=(await new o.ConnectionPool(s).connect()).request();var n="sp_Cart_Get";try{e.params.id&&r.input("userId",o.Int,e.params.id);var i=await r.execute(n);t.status(200).json(i.recordset)}catch(e){a.logError("sqlserver",n,e),t.status(201).json({"sp_data:":null})}},newCartitem:async(e,t)=>{try{const{userId:d,item:u}=e.body;let c=await new o.ConnectionPool(s).connect();const l=new o.Transaction(c);await l.begin(),console.log("begin transaction");try{var r=await n.existsOrnot_Cartforuserid(d),a=0;0==r?a=(await l.request().input("userId",o.Int,d).query("INSERT INTO Carts (userId) OUTPUT INSERTED.id VALUES (@userId)")).recordset[0].id:(console.log("AAAAAAAAAAAAAAAAAAAAAAA searching cartId for userId:"+d),a=await n.return_CartIDforuserid(d)),0==await i.existsOrnot_ProductInCart(a,u.productId)?(console.log("trying to inserting cartitem with quantity:"+u.quantity),await l.request().input("cartId",o.Int,a).input("productId",o.Int,u.productId).input("product_name",o.VarChar,u.product_name).input("price",o.Int,u.price).input("quantity",o.Float,u.quantity).input("pmultq",o.Decimal,u.pmultq).input("seller_id",o.Int,u.seller_id).input("seller_name",o.VarChar,u.seller_name).input("CPorCQ",o.VarChar,u.CPorCQ).input("selectedUnit",o.Int,u.selectedUnit).input("CREATEDBY_username",o.VarChar,u.CREATEDBY_username).query("INSERT INTO cartItems (cartId,seller_id,seller_name, productId,product_name,price, quantity,pmultq,CPorCQ,selectedUnit,CREATEDBY_username) \n                              VALUES (@cartId,@seller_id,@seller_name, @productId,@product_name,@price, @quantity,@pmultq,@CPorCQ,@selectedUnit,@CREATEDBY_username)")):(console.log("already existsing item in cartitem"),console.log("now quantity is:"+u.quantity),console.log("now pmulq is:"+u.pmultq),await l.request().input("cartId",o.Int,a).input("productId",o.Int,u.productId).input("quantity",u.quantity).input("price",u.price).input("pmultq",u.pmultq).input("CPorCQ",u.CPorCQ).input("selectedUnit",u.selectedUnit).input("CREATEDBY_username",u.CREATEDBY_username).query("Update cartItems set quantity=@quantity, price=@price,pmultq=@pmultq, CPorCQ=@CPorCQ, selectedUnit=@selectedUnit where cartId=@cartId and productId=@productId"),console.log("@cartId:"+a)),await l.commit(),t.status(200)}catch(e){throw await l.rollback(),console.log("error:"+e),e}}catch(e){t.status(500).send(e.message)}finally{o.close()}},deleteCartitem:async(e,t)=>{console.log("deleting caritem with id:"+e.params.id);let r=await new o.ConnectionPool(s).connect();const a=new o.Transaction(r);await a.begin(),console.log("begin transaction");try{await a.request().input("id",o.Int,e.params.id).query("Delete From cartItems Where Id=@id");const r=await a.request().input("id",o.Int,e.params.id).query("Select * From cartItems Where cartId=(Select cartId From cartitems where id=@id)");0==i.existsOrnot_CartitemsInCart(e.params.id)&&console.log("deleting cart record also..."),await a.commit(),t.status(200).send(r.recordset)}catch(e){t.status(500).send(e.message)}finally{o.close()}}}},8904:(e,t,r)=>{var o=r(9424),s=r(5724);const a=new o.ConnectionPool(s);e.exports={existsOrnot_Cartforuserid:async e=>{try{let t=await new o.ConnectionPool(s).connect();return 0!=(await t.request().input("userId",o.Int,e).query("SELECT count(*) usercartcount FROM Carts WHERE userId = @userId")).recordset[0].usercartcount}catch(e){console.log(e)}finally{a.close()}},return_CartIDforuserid:async e=>{setTimeout((()=>{}),4e3);try{console.log("min return_CartIDforuserid");let t=await new o.ConnectionPool(s).connect();const r=await t.request().input("userId",o.Int,e).query("SELECT id usercartId FROM Carts WHERE userId = @userId");return console.log("min return_CartIDforuserid returning cartid"),r.recordset[0].usercartId}catch(e){console.log(e)}finally{console.log("min return_CartIDforuserid closing pool"),a.close()}}}},5656:(e,t,r)=>{var o=r(9424),s=r(5724);const a=new o.ConnectionPool(s);e.exports={existsOrnot_ProductInCart:async(e,t)=>{try{return await a.connect(),0!=(await a.request().input("cartId",o.Int,e).input("productId",o.Int,t).query("SELECT count(*) cartitem_count FROM cartitems WHERE cartId = @cartId and productId=@productId")).recordset[0].cartitem_count}catch(e){console.log(e)}finally{a.close()}},return_CartitemIDforuserid:async e=>{try{return await a.connect(),(await a.request().input("userId",o.Int,e).query("SELECT id usercartId FROM Carts WHERE userId = @userId")).recordset[0].usercartId}catch(e){console.log(e)}finally{a.close()}},existsOrnot_CartitemsInCart:async e=>{try{await a.connect();const t=await a.request().input("cartId",o.Int,e).query("SELECT count(*) cartitem_count From cartItems Where cartId=(Select cartId From cartitems where id=@cartId)");return console.log("result.recordset[0].cartitem_count==0:"+t.recordset[0].cartitem_count==0),0!=t.recordset[0].cartitem_count}catch(e){console.log(e)}finally{o.close(),a.close()}}}},9122:(e,t,r)=>{var o=r(6860).Router(),s=r(8997);o.route("/:id?/:sellerdids?").get(s.getCategories),o.route("/").post(s.newProduct),o.route("/:id?").put(s.editUsers),o.route("/:id").delete(s.deleteUsers),e.exports=o},8997:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185);e.exports={getCategories:async(e,t)=>{const r=(await new o.ConnectionPool(s).connect()).request();var n="sp_Categorys_Get";try{e.params.id?r.input("id",o.Int,e.params.id):r.input("id",o.Int,0),e.params.sellerdids?r.input("sellerdids",o.VarChar,e.params.sellerdids):r.input("sellerdids",o.VarChar,"");var i=await r.execute(n);t.status(200).json(i.recordset)}catch(e){a.logError("sqlserver",n,e),t.status(201).json({"sp_data:":null})}},newProduct:(e,t)=>{console.log("Adding new product with req.body:"+JSON.stringify(e.body)+", sellerid:"+e.body.seller_id+"p name:"+e.body.product_name),new o.ConnectionPool(s).connect().then((r=>{const s=r.request();s.input("seller_id",o.Int,e.body.seller_id),s.input("product_name",o.VarChar,e.body.product_name),s.input("imageUrl",o.VarChar,e.body.imageUrl),s.execute("sp_Product_AddEdit",((e,r)=>{e&&(console.log("this is error"),t.status(401).json({"Error in SP sp_Product_AddEdit:":e})),console.log("result:"+e),t.status(200).json({"New Product:":"Added"})}))}))},newUsers:(e,t)=>{new o.ConnectionPool(s).connect().then((r=>{const s=r.request();s.input("ID",o.Int,e.body.userid),s.input("salutation",o.VarChar,e.body.salutation),s.input("Owner_Fname",o.VarChar,e.body.Owner_Fname),s.input("Owner_Lname",o.VarChar,e.body.Owner_Lname),s.input("FlatNo",o.Int,e.body.FlatNo),s.input("DP_base64",o.VarChar(50),e.body.DP_base64),s.execute("sp_Users_AddEdit",((e,r)=>{e&&(console.log("this is error"),t.status(401).json({"Error in SP sp_Register_CheckPermissionsOfDeviceid:":e})),console.log("result:"+e),t.status(200).json({"New Users:":"Added"})}))}))},editUsers:async(e,t)=>{var r,n="sp_Users_AddEdit";r=e.params.id?e.params.id:0,console.log("m here editing:salutation"+e.body.Owner_Lname);let i=await new o.ConnectionPool(s).connect();const d=await i.request();d.input("ID",o.Int,r),d.input("salutation",o.VarChar,e.body.salutation),d.input("Owner_Fname",o.VarChar(50),e.body.Owner_Fname),d.input("Owner_Lname",o.VarChar(50),e.body.Owner_Lname),d.input("FlatNo",o.Int,e.body.FlatNo),d.input("DP_base64",o.VarChar(50),e.body.DP_base64);try{var u=await d.execute(n);t.status(200).json({"New Users:":u})}catch(e){a.logError("sqlserver",n,e),t.status(200).json({"New Users:":u})}},deleteUsers:async(e,t)=>{var r,n="sp_Users_Delete";r=e.params.id?e.params.id:0,console.log("m here editing:salutation"+e.body.Owner_Lname);let i=await new o.ConnectionPool(s).connect();const d=await i.request();d.input("ID",o.Int,r);try{var u=await d.execute(n)}catch(e){a.logError("sqlserver",n,e),t.status(200).json({"New Users:":u})}}}},262:(e,t,r)=>{var o=r(6860).Router(),s=r(9870);o.route("/").get(s.getErrorLogs),o.route("/").delete(s.deleteErrorLogs),e.exports=o},9870:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185);e.exports={getErrorLogs:async(e,t)=>{var r="sp_getErrorLog";const n=(await new o.ConnectionPool(s).connect()).request();try{var i=await n.execute(r);t.status(200).json({sp_data:i})}catch(e){a.logError("sqlserver",r,e),t.status(200).json({"sp_data:":null})}},deleteErrorLogs:async(e,t)=>{var r="ErrorLog_Truncate";const n=(await new o.ConnectionPool(s).connect()).request();try{var i=await n.execute(r);t.status(200).json({sp_data:i})}catch(e){a.logError("sqlserver",r,e),t.status(200).json({"sp_data:":null})}}}},1955:(e,t,r)=>{var o=r(6860).Router(),s=r(1584);o.route("/:id").post(s.getLoggedin),e.exports=o},1584:(e,t,r)=>{r(9424),r(5724),r(3185);var o=r(1792);const s=r(9344);var a=r(3453);e.exports={getLoggedin:async(e,t)=>{e.params.id||t.status(200).send({user:null,error:"Login By Device Or Credential not defined"});let r=e.body;var n;if(r||t.status(501).send({error:"no credential passed"}),"bydeviceid"==e.params.id?n=await o.FindDeviceAndReturnUser(e,t,r.deviceid):"bycredential"==e.params.id&&(n=await o.FindCredentialAndReturnUser(e,t,r.userid,r.password)),null!=n){var i=s.sign({userid:r.userid},"secret");console.log("sending accessToken:"+i),console.log("user.userid:"+r.userid),a("userid",n.userid),t.status(201).json({user:n,accessToken:i})}else console.log("wrong user passO"),t.status(401).send({user:null,error:"Wrong username or password"})}}},3857:(e,t,r)=>{const o=r(9344);e.exports={auth:function(e,t,r){if(console.log("req.originalUrl:"+e.originalUrl+" method:"+e.originalUrl.includes("/api/")),e.originalUrl.includes("/api/product")&&"GET"==e.method||"/api/login/"==e.originalUrl&&"POST"==e.method||"/api/signup"==e.originalUrl&&"POST"==e.method||e.originalUrl.includes("/api/Device/")&&"GET"==e.method)return void r();console.log("req.header 'authorization' is:->"+e.header("authorization")),console.log("after removed quotes"+e.header("authorization").replace(/"/g,""));const s=e.header("authorization").replace(/"/g,"").split(" ")[1];if(console.log("my authHeader:--\x3e"+s+"<--"),null===s)return t.status(401).json({error:"Access-Denied"});try{const t=o.verify(s,"secret");e.id={userid:t.userid},r()}catch(e){console.log("Invalid Token"+e),t.status(401).json({error:"Invalid token"})}}}},2349:(e,t,r)=>{var o=r(6860).Router(),s=r(6478);o.route("/:id/:orderid").get(s.getOrderItems),e.exports=o},6478:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185),n=r(8904),i=r(5656),d=r(9347);e.exports={getOrder:async(e,t)=>{console.log("getOrder id:"+e.params.id);const r=(await new o.ConnectionPool(s).connect()).request();var n="sp_Order_Get";try{e.params.id&&r.input("userId",o.Int,e.params.id);var i=await r.execute(n);t.status(200).json(i.recordset)}catch(e){a.logError("sqlserver",n,e),t.status(201).json({"sp_data:":null})}},getOrderItems:async(e,t)=>{try{const r=(await new o.ConnectionPool(s).connect()).request(),a="sp_OrderItems_Get";(e.params.id||void 0!==e.params.id)&&r.input("id",o.Int,e.params.id),(e.params.orderid||void 0!==e.params.orderid)&&r.input("orderid",o.Int,e.params.orderid);const n=await r.execute(a);t.status(200).json(n.recordset)}catch(e){a.logError("sqlserver","getOrderItems",e),t.status(500).json({message:"Internal server error"})}},newOrder:async(e,t)=>{try{const{order_status:a,userId:i,seller_id:u,orderdate:c,orderItems:l}=e.body;console.log("orderdate:"+c);let p=await new o.ConnectionPool(s).connect();const m=new o.Transaction(p);await m.begin(),console.log("begin transaction");try{var r;if(!await n.existsOrnot_Cartforuserid(i))throw new Error(`Cart not found for user with id ${i}`);console.log("cart exists for user n date"),r=(await m.request().input("order_status",o.VarChar,a).input("userId",o.Int,i).input("seller_id",o.Int,u).input("orderdate",o.DateTime,c).query("INSERT INTO [Order] (order_status,userId,seller_id,orderdate)  OUTPUT INSERTED.id  VALUES (@order_status,@userId,@seller_id,@orderdate)")).recordset[0].id,console.log("newly gen orderId:"+r+" with orderdate:"+c+" and orderItems are "+l.length+" in count");for(const e of l){if(0==d.existsOrnot_Productforid(e.productId))throw new Error(`Product with id ${e.productId} not found`);await m.request().input("orderId",o.Int,r).input("productId",o.Int,e.productId).query("INSERT INTO [OrderItem] (OrderId,productId)  OUTPUT INSERTED.id  VALUES (@orderId,@productId)")}for(const e of l)console.log("deleting cartitem of id:"+e.id),await m.request().input("orderId",o.Int,r).input("productId",o.Int,e.productId).query("delete from cartitems where id="+e.id);await m.commit(),t.status(200)}catch(e){throw await m.rollback(),console.log("error:"+e),e}}catch(e){t.status(500).send(e.message)}finally{o.close()}},deleteCartitem:async(e,t)=>{console.log("deleting caritem with id:"+e.params.id);let r=await new o.ConnectionPool(s).connect();const a=new o.Transaction(r);await a.begin(),console.log("begin transaction");try{await a.request().input("id",o.Int,e.params.id).query("Delete From cartItems Where Id=@id");const r=await a.request().input("id",o.Int,e.params.id).query("Select * From cartItems Where cartId=(Select cartId From cartitems where id=@id)");0==i.existsOrnot_CartitemsInCart(e.params.id)&&console.log("deleting cart record also..."),await a.commit(),t.status(200).send(r.recordset)}catch(e){t.status(500).send(e.message)}finally{o.close()}}}},9757:(e,t,r)=>{var o=r(6860).Router(),s=r(2608);o.route("/:customerId/:sellerId/:orderStatus?/:PageNumber?/:PageSize?").get(s.getOrders),o.route("/").post(s.newOrder),o.route("/:id").put(s.changeOrder),o.route("/:id").delete(s.deleteCartitem),e.exports=o},2608:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185),n=r(8904),i=r(5656),d=r(9347);e.exports={getOrder:async(e,t)=>{console.log("getOrder id:"+e.params.id);const r=(await new o.ConnectionPool(s).connect()).request();var n="sp_Order_Get";try{e.params.id&&r.input("userId",o.Int,e.params.id);var i=await r.execute(n);t.status(200).json(i.recordset)}catch(e){a.logError("sqlserver",n,e),t.status(201).json({"sp_data:":null})}},getOrders:async(e,t)=>{try{const r=(await new o.ConnectionPool(s).connect()).request(),a="sp_Order_Of_Seller_Status_Get";(e.params.customerId||void 0!==e.params.customerId)&&r.input("customerId",o.Int,e.params.customerId),e.params.sellerId&&r.input("sellerId",o.Int,e.params.sellerId),e.params.orderStatus&&r.input("orderStatus",o.NVarChar(50),e.params.orderStatus),e.params.PageNumber&&r.input("PageNumber",o.NVarChar(50),e.params.PageNumber),e.params.PageSize&&r.input("PageSize",o.NVarChar(50),e.params.PageSize);const n=await r.execute(a);t.status(200).json(n.recordset)}catch(e){a.logError("sqlserver","getOrders",e),t.status(500).json({message:"Internal server error"})}},newOrder:async(e,t)=>{try{const{order_status:a,userId:i,seller_id:u,orderdate:c,orderItems:l,totalAmount:p,discount:m}=e.body;console.log("orderdate:"+c);let g=await new o.ConnectionPool(s).connect();const y=new o.Transaction(g);await y.begin(),console.log("begin transaction");try{var r;if(!await n.existsOrnot_Cartforuserid(i))throw new Error(`Cart not found for user with id ${i}`);console.log("cart exists for user n date"),r=(await y.request().input("order_status",o.VarChar,a).input("userId",o.Int,i).input("seller_id",o.Int,u).input("orderdate",o.DateTime,c).input("totalAmount",o.Int,p).input("discount",o.Int,m).query("INSERT INTO [Order] (order_status,userId,seller_id,orderdate,total,discount)  OUTPUT INSERTED.id  VALUES (@order_status,@userId,@seller_id,@orderdate,@totalAmount,@discount)")).recordset[0].id,console.log("newly gen orderId:"+r+" with orderdate:"+c+" and orderItems are "+l.length+" in count");for(const e of l){if(0==d.existsOrnot_Productforid(e.productId))throw new Error(`Product with id ${e.productId} not found`);await y.request().input("orderId",o.Int,r).input("productId",o.Int,e.productId).input("price",o.Int,e.price).input("quantity",o.Int,e.quantity).input("pmultq",o.Float,e.pmultq).input("selectedUnit",o.Int,e.selectedUnit).input("CPorCQ",o.VarChar,e.CPorCQ).input("seller_id",o.Int,u).query("INSERT INTO [OrderItem] (OrderId,seller_id,productId,price,quantity ,pmultq,selectedUnit, CPorCQ)  \n   OUTPUT INSERTED.id  VALUES (@orderId,@seller_id,@productId,@price,@quantity,@pmultq,@selectedUnit,@CPorCQ)")}for(const e of l)console.log("deleting cartitem of id:"+e.id),await y.request().input("orderId",o.Int,r).input("productId",o.Int,e.productId).query("delete from cartitems where id="+e.id);await y.commit(),t.status(200)}catch(e){throw await y.rollback(),console.log("error:"+e),e}}catch(e){t.status(500).send(e.message)}finally{o.close()}},changeOrder:async(e,t)=>{console.log("m in changeOrder and id is:"+e.params.id),(async(e,t)=>{console.log("m changing status of orderid:"+e.query.orderid+" to "+e.query.orderstatus);const r=(await new o.ConnectionPool(s).connect()).request();var n="sp_Order_Statuschange";try{r.input("orderid",o.Int,e.query.orderid),r.input("orderstatus",o.VarChar,e.query.orderstatus);var i=await r.execute(n);t.status(200).json(i.recordset)}catch(e){a.logError("sqlserver",n,e),t.status(201).json({"sp_data:":null})}})(e,t),t.status(200)},deleteCartitem:async(e,t)=>{console.log("deleting caritem with id:"+e.params.id);let r=await new o.ConnectionPool(s).connect();const a=new o.Transaction(r);await a.begin(),console.log("begin transaction");try{await a.request().input("id",o.Int,e.params.id).query("Delete From cartItems Where Id=@id");const r=await a.request().input("id",o.Int,e.params.id).query("Select * From cartItems Where cartId=(Select cartId From cartitems where id=@id)");0==i.existsOrnot_CartitemsInCart(e.params.id)&&console.log("deleting cart record also..."),await a.commit(),t.status(200).send(r.recordset)}catch(e){t.status(500).send(e.message)}finally{o.close()}}}},4190:(e,t,r)=>{var o=r(6860).Router(),s=r(5814);o.route("/:sellerId/:orderStatus?").get(s.getOrders_Commission),o.route("/:id").put(s.chgOrders_Commission),e.exports=o},5814:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185);e.exports={getOrders_Commission:async(e,t)=>{try{const r=(await new o.ConnectionPool(s).connect()).request(),a="sp_Orders_Commission_Get";e.params.sellerId&&r.input("sellerId",o.Int,e.params.sellerId),e.params.orderStatus&&r.input("orderStatus",o.NVarChar(50),e.params.orderStatus);const n=await r.execute(a);t.status(200).json(n.recordset)}catch(e){a.logError("sqlserver","getOrders_Commission",e),t.status(500).json({message:"Internal server error"})}},chgOrders_Commission:async(e,t)=>{"PayCommission"==e.params.id&&(async(e,t)=>{console.log("AAAAAAAAAAAAAAAAAAA req.query.orderIds_comma_seperated:"+e.query.orderIds_comma_seperated);try{const r=(await new o.ConnectionPool(s).connect()).request(),a="sp_Order_Commission_UpdateAsPaid";e.query.orderId&&r.input("orderid",o.Int,e.query.orderId),e.query.orderIds_comma_seperated&&r.input("orderIds_comma_seperated",o.VarChar,e.query.orderIds_comma_seperated);const n=await r.execute(a);t.status(200).json(n.recordset)}catch(e){a.logError("sqlserver",sp_name,e),t.status(500).json({message:"Internal server error"})}})(e,t)}}},5966:(e,t,r)=>{var o=r(6860).Router(),s=r(5818);o.route("/").get(s.get_Parameter_Setting),e.exports=o},5818:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185);e.exports={get_Parameter_Setting:async(e,t)=>{const r=(await new o.ConnectionPool(s).connect()).request();var n="sp_Parameter_Setting_Get";try{var i=await r.execute(n);t.status(200).json(i.recordset)}catch(e){a.logError("sqlserver",n,e),t.status(201).json({"sp_data:":null})}},edit_Seller_Commission_Setting:async(e,t)=>{console.log("m editing edit_Seller_Commission_Setting"),console.log("req.params.id:"+e.params.id),console.log("req.body:"+JSON.stringify(e.body));var r="sp_Seller_Commission_Setting_AddEdit";let n=await new o.ConnectionPool(s).connect();const i=await n.request();i.input("sellerid",o.VarChar,e.body.seller_id),i.input("commission_percent",o.VarChar(50),e.body.commission_percent),i.input("credit_limit",o.VarChar(50),e.body.credit_limit);try{var d=await i.execute(r);t.status(200).json({"New Users:":d})}catch(e){a.logError("sqlserver",r,e),t.status(200).json({"New Users:":d})}},newProduct:(e,t)=>{console.log("Adding new product with req.body:"+JSON.stringify(e.body)+", sellerid:"+e.body.seller_id+"p name:"+e.body.product_name),new o.ConnectionPool(s).connect().then((r=>{const s=r.request();s.input("seller_id",o.Int,e.body.seller_id),s.input("product_name",o.VarChar,e.body.product_name),s.input("imageUrl",o.VarChar,e.body.imageUrl),s.execute("sp_Product_AddEdit",((e,r)=>{e&&(console.log("this is error"),t.status(401).json({"Error in SP sp_Product_AddEdit:":e})),console.log("result:"+e),t.status(200).json({"New Product:":"Added"})}))}))},newUsers:(e,t)=>{new o.ConnectionPool(s).connect().then((r=>{const s=r.request();s.input("ID",o.Int,e.body.userid),s.input("salutation",o.VarChar,e.body.salutation),s.input("Owner_Fname",o.VarChar,e.body.Owner_Fname),s.input("Owner_Lname",o.VarChar,e.body.Owner_Lname),s.input("FlatNo",o.Int,e.body.FlatNo),s.input("DP_base64",o.VarChar(50),e.body.DP_base64),s.execute("sp_Users_AddEdit",((e,r)=>{e&&(console.log("this is error"),t.status(401).json({"Error in SP sp_Register_CheckPermissionsOfDeviceid:":e})),console.log("result:"+e),t.status(200).json({"New Users:":"Added"})}))}))},editUsers:async(e,t)=>{var r,n="sp_Users_AddEdit";r=e.params.id?e.params.id:0,console.log("m here editing:salutation"+e.body.Owner_Lname);let i=await new o.ConnectionPool(s).connect();const d=await i.request();d.input("ID",o.Int,r),d.input("salutation",o.VarChar,e.body.salutation),d.input("Owner_Fname",o.VarChar(50),e.body.Owner_Fname),d.input("Owner_Lname",o.VarChar(50),e.body.Owner_Lname),d.input("FlatNo",o.Int,e.body.FlatNo),d.input("DP_base64",o.VarChar(50),e.body.DP_base64);try{var u=await d.execute(n);t.status(200).json({"New Users:":u})}catch(e){a.logError("sqlserver",n,e),t.status(200).json({"New Users:":u})}},deleteUsers:async(e,t)=>{var r,n="sp_Users_Delete";r=e.params.id?e.params.id:0,console.log("m here editing:salutation"+e.body.Owner_Lname);let i=await new o.ConnectionPool(s).connect();const d=await i.request();d.input("ID",o.Int,r);try{var u=await d.execute(n)}catch(e){a.logError("sqlserver",n,e),t.status(200).json({"New Users:":u})}}}},6538:(e,t,r)=>{var o=r(6860).Router(),s=r(3487);o.route("/:id?/:ProductId?").get(s.get_Product_Quantity),e.exports=o},3487:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185);r(8904),r(5656),e.exports={get_Product_Quantity:async(e,t)=>{console.log("get_Product_Quantity id:"+e.params.id);const r=(await new o.ConnectionPool(s).connect()).request();var n="sp_Product_Quantity_Get";try{e.params.id&&r.input("id",o.Int,e.params.id),e.params.ProductId&&r.input("ProductId",o.Int,e.params.ProductId);var i=await r.execute(n);t.status(200).json(i.recordset)}catch(e){a.logError("sqlserver",n,e),t.status(201).json({"sp_data:":null})}}}},5800:(e,t,r)=>{var o=r(6860).Router(),s=r(3336),a=r(3933);o.route("/:productId/:seller_id/:PageNumber/:PageSize/:sellerIDs/:categoryIDs/:productIds/:partialname/:skipIdsFromCartItems?").get(s.getProductsNew),o.route("/").post(a.upload.single("icon"),s.newProduct),o.route("/:id?").put(a.upload.single("icon"),s.newProduct),o.route("/:id").delete(s.deleteUsers),e.exports=o},3336:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185);e.exports={getProductsNew:async(e,t)=>{const r=(await new o.ConnectionPool(s).connect()).request();var n="sp_new_products_Get";try{e.params.productId?r.input("productId",o.Int,e.params.productId):r.input("productId",o.Int,0),e.params.seller_id?r.input("seller_id",o.Int,e.params.seller_id):r.input("seller_id",o.Int,0),e.params.PageNumber?r.input("PageNumber",o.Int,e.params.PageNumber):r.input("PageNumber",o.Int,0),e.params.PageSize?r.input("PageSize",o.Int,e.params.PageSize):r.input("PageSize",o.Int,0),e.params.sellerIDs?r.input("sellerIDs",o.VarChar,e.params.sellerIDs):r.input("sellerIDs",o.VarChar,""),e.params.categoryIDs?r.input("categoryIDs",o.VarChar,e.params.categoryIDs):r.input("categoryIDs",o.VarChar,""),e.params.productIds?(console.log("param productIds found"),r.input("productIds",o.VarChar,e.params.productIds)):r.input("productIds",o.VarChar,""),e.params.partialname?r.input("partialname",o.VarChar,e.params.partialname):r.input("partialname",o.VarChar,""),e.params.skipIdsFromCartItems?r.input("skipIdsFromCartItems",o.VarChar,e.params.skipIdsFromCartItems):r.input("skipIdsFromCartItems",o.Bit,"");var i=await r.execute(n);t.status(200).json(i.recordset)}catch(e){a.logError("sqlserver",n,e),t.status(201).json({"sp_data:":null})}},newProduct:async(e,t)=>{console.log("Adding new product with req.body:"+JSON.stringify(e.body)+", sellerid:"+e.body.seller_id+"p name:"+e.body.product_name);var r="";null!=e.body.imageUrl&&(r=e.body.imageUrl);var n="sp_Product_AddEdit";let i=await new o.ConnectionPool(s).connect();console.log("req.body.Allowed_customPrice:"+e.body.Allowed_customPrice),console.log("req.body.Allowed_customQuantity:"+e.body.Allowed_customQuantity);const d=await i.request();d.input("id",o.Int,e.body.id),d.input("seller_id",o.Int,e.body.seller_id),d.input("product_name",o.VarChar,e.body.product_name),d.input("category_id",o.Int,e.body.category_id),d.input("imageUrl",o.VarChar,r),d.input("price",o.VarChar,e.body.price),d.input("description",o.VarChar,e.body.description),d.input("OutOfStock",o.VarChar,e.body.OutOfStock),d.input("IsOnlyForAdvertise",o.VarChar,e.body.IsOnlyForAdvertise),d.input("discount_text",o.VarChar,e.body.discount_text),d.input("unit_id",o.Int,e.body.unit_id),d.input("Allowed_customQuantity",o.VarChar,e.body.Allowed_customQuantity),d.input("CREATEDBY_username",o.VarChar,e.body.CREATEDBY_username);try{var u=await d.execute(n);t.status(200).json({"New Users:":u})}catch(e){a.logError("sqlserver",n,e),t.status(500).json({Number:e.number,Message:e.message})}},newUsers:(e,t)=>{new o.ConnectionPool(s).connect().then((r=>{const s=r.request();s.input("ID",o.Int,e.body.userid),s.input("salutation",o.VarChar,e.body.salutation),s.input("Owner_Fname",o.VarChar,e.body.Owner_Fname),s.input("Owner_Lname",o.VarChar,e.body.Owner_Lname),s.input("FlatNo",o.Int,e.body.FlatNo),s.input("DP_base64",o.VarChar(50),e.body.DP_base64),s.execute("sp_Users_AddEdit",((e,r)=>{e&&(console.log("this is error"),t.status(401).json({"Error in SP sp_Register_CheckPermissionsOfDeviceid:":e})),console.log("result:"+e),t.status(200).json({"New Users:":"Added"})}))}))},editUsers:async(e,t)=>{var r,n="sp_Users_AddEdit";r=e.params.id?e.params.id:0,console.log("m here editing:salutation"+e.body.Owner_Lname);let i=await new o.ConnectionPool(s).connect();const d=await i.request();d.input("ID",o.Int,r),d.input("salutation",o.VarChar,e.body.salutation),d.input("Owner_Fname",o.VarChar(50),e.body.Owner_Fname),d.input("Owner_Lname",o.VarChar(50),e.body.Owner_Lname),d.input("FlatNo",o.Int,e.body.FlatNo),d.input("DP_base64",o.VarChar(50),e.body.DP_base64);try{var u=await d.execute(n);t.status(200).json({"New Users:":u})}catch(e){a.logError("sqlserver",n,e),t.status(200).json({"New Users:":u})}},deleteUsers:async(e,t)=>{var r,n="sp_Users_Delete";r=e.params.id?e.params.id:0,console.log("m here editing:salutation"+e.body.Owner_Lname);let i=await new o.ConnectionPool(s).connect();const d=await i.request();d.input("ID",o.Int,r);try{var u=await d.execute(n)}catch(e){a.logError("sqlserver",n,e),t.status(200).json({"New Users:":u})}}}},4448:(e,t,r)=>{var o=r(6860).Router(),s=r(4741);o.route("/:id/:seller_id").get(s.getPromotionOrders),o.route("/:id?").post(s.newPromotionOrder),o.route("/:id").delete(s.deletePromotionOrder),e.exports=o},4741:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185);const n=r(8982);e.exports={getPromotionOrders:async(e,t)=>{const r=(await new o.ConnectionPool(s).connect()).request();var n="sp_Promotion_Orders_Get";try{r.input("id",o.Int,e.params.id),r.input("seller_id",o.Int,e.params.seller_id);var i=await r.execute(n);t.status(200).json(i.recordset)}catch(e){a.logError("sqlserver",n,e),t.status(201).json({"sp_data:":null})}},newPromotionOrder:async(e,t)=>{var r;r=null==e.params.id?0:e.params.id;const i=n(e.body.startDate).format("MM/DD/YYYY HH:mm:ss"),d=n(e.body.endDate).format("MM/DD/YYYY HH:mm:ss");console.log("----------------------------------------------------------------"),console.log("now formattedDate_startDate is:"+i),console.log("now formattedDate_endDate is:"+d),n(e.body.endDate).toDate();var u="sp_PromotionOrder_AddEdit";const c=(await new o.ConnectionPool(s).connect()).request();c.input("id",o.Int,r),c.input("seller_id",o.Int,e.body.seller_id),c.input("promotionType",o.VarChar,e.body.promoType),c.input("promotionName",o.VarChar,e.body.promotionName),c.input("discountAmount",o.Decimal,e.body.discountAmount),c.input("discountPercentage",o.Float,e.body.discountPercentage),c.input("minOrderAmount",o.Int,e.body.minOrderAmount),c.input("startDate",o.DateTime,i),c.input("endDate",o.DateTime,d);try{var l=await c.execute(u);t.status(200).json({sp_data:l.recordset})}catch(e){a.logError("sqlserver",u,e),t.status(200).json({sp_data:null})}},deletePromotionOrder:async(e,t)=>{var r="sp_PromotionOrder_Delete";const n=(await new o.ConnectionPool(s).connect()).request();n.input("id",o.Int,e.params.id);try{var i=await n.execute(r);t.status(200).json({sp_data:i.recordset})}catch(e){a.logError("sqlserver",r,e),t.status(200).json({sp_data:null})}}}},4435:(e,t,r)=>{var o=r(6860).Router(),s=r(6074);o.route("/:id/:seller_id").get(s.getPromotionProducts),o.route("/:id?").post(s.newPromotionProduct),o.route("/:id").delete(s.deletePromotionProduct),e.exports=o},6074:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185);const n=r(8982);e.exports={getPromotionProducts:async(e,t)=>{const r=(await new o.ConnectionPool(s).connect()).request();var n="sp_Promotion_Products_Get";try{r.input("id",o.Int,e.params.id),r.input("seller_id",o.Int,e.params.seller_id);var i=await r.execute(n);t.status(200).json(i.recordset)}catch(e){a.logError("sqlserver",n,e),t.status(201).json({"sp_data:":null})}},newPromotionProduct:async(e,t)=>{var r;r=null==e.params.id?0:e.params.id,console.log("req.body.startDate:"+e.body.startDate);const i=n(e.body.startDate).format("MM/DD/YYYY HH:mm:ss"),d=n(e.body.endDate).format("MM/DD/YYYY HH:mm:ss");console.log("----------------------------------------------------------------"),console.log("now formattedDate_startDate is:"+i),console.log("now formattedDate_endDate is:"+d),n(e.body.endDate).toDate();var u="sp_PromotionProduct_AddEdit";const c=(await new o.ConnectionPool(s).connect()).request();c.input("id",o.Int,r),c.input("seller_id",o.Int,e.body.seller_id),c.input("productId",o.Int,e.body.productId),c.input("promotionType",o.VarChar,e.body.promoType),c.input("promotionName",o.VarChar,e.body.promotionName),c.input("buyX",o.Int,e.body.buyX),c.input("getY",o.Int,e.body.getY),c.input("discountAmount",o.Decimal,e.body.discountAmount),c.input("discountPercentage",o.Float,e.body.discountPercentage),c.input("startDate",o.DateTime,i),c.input("endDate",o.DateTime,d);try{var l=await c.execute(u);t.status(200).json({sp_data:l.recordset})}catch(e){a.logError("sqlserver",u,e),t.status(200).json({sp_data:null})}},deletePromotionProduct:async(e,t)=>{var r="sp_PromotionProduct_Delete";const n=(await new o.ConnectionPool(s).connect()).request();n.input("id",o.Int,e.params.id);try{var i=await n.execute(r);t.status(200).json({sp_data:i.recordset})}catch(e){a.logError("sqlserver",r,e),t.status(200).json({sp_data:null})}}}},4266:(e,t,r)=>{var o=r(6860).Router(),s=r(7424);o.route("/:id/:seller_id").get(s.getPromotionQuantity),o.route("/:id?").put(s.editPromotionQuantity),e.exports=o},7424:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185);const n=r(8982);e.exports={getPromotionQuantity:async(e,t)=>{const r=(await new o.ConnectionPool(s).connect()).request();var n="sp_Promotion_Quantity_Get";try{r.input("id",o.Int,e.params.id),r.input("seller_id",o.Int,e.params.seller_id);var i=await r.execute(n);t.status(200).json(i.recordset)}catch(e){a.logError("sqlserver",n,e),t.status(201).json({"sp_data:":null})}},editPromotionQuantity:async(e,t)=>{console.log("req.body AAAAAAAAAAAAAAAAAAAAAAA:"+JSON.stringify(e.body));const r=e.body;console.log("detail bbbbbbbbbbbbbbbbbbbbbb:"+r.quantityStagesFormArray);const i=r,d=[];for(let e=1;e<r.quantityStagesFormArray.length;e++){const{QuantityPromotion_stage_id:t,quantityRangeStart:o,quantityRangeEnd:s,discountAmount:a,discountPercentage:n}=r.quantityStagesFormArray[e],i={QuantityPromotion_stage_id:t,quantityRangeStart:o,quantityRangeEnd:s,discountAmount:a,discountPercentage:n};d.push(i)}console.log("detailData:"+d);const u=await(async(e,t)=>{let r=await new o.ConnectionPool(s).connect();const i=new o.Transaction(r);try{await i.begin();const r=n(e.startDate).format("MM/DD/YYYY HH:mm:ss"),s=n(e.endDate).format("MM/DD/YYYY HH:mm:ss"),a=i.request();a.input("QuantityPromotion_id",o.Int,e.id),a.input("seller_id",o.Int,e.seller_id),a.input("productId",o.Int,e.productId),a.input("promotionName",o.VarChar,e.promotionName),a.input("startDate",o.DateTime,r),a.input("endDate",o.DateTime,s);const d=(await a.execute("sp_PromotionQuantity_Edit")).recordset[0].id;for(const e of t){const t=i.request();t.input("QuantityPromotion_id",o.Int,d),t.input("quantityRangeStart",o.Int,e.quantityRangeStart),t.input("quantityRangeEnd",o.Int,e.quantityRangeEnd),t.input("discountAmount",o.Decimal,e.discountAmount),t.input("discountPercentage",o.Float,e.discountPercentage),await t.execute("sp_PromotionQuantity_Stages")}return await i.commit(),!0}catch(e){return await i.rollback(),a.logError("sqlserver","saveQuantityPromotionData",e),!1}finally{r.close()}})(i,d);u?t.status(200).json({success:!0}):t.status(500).json({success:!1})}}},2878:(e,t,r)=>{var o=r(6860).Router(),s=r(5243);o.route("/").get(s.getPromotionMast),e.exports=o},5243:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185);e.exports={getPromotionMast:async(e,t)=>{const r=(await new o.ConnectionPool(s).connect()).request();var n="sp_PromotionMast_Get";try{var i=await r.execute(n);t.status(200).json(i.recordset)}catch(e){a.logError("sqlserver",n,e),t.status(201).json({"sp_data:":null})}}}},1494:(e,t,r)=>{var o=r(6860).Router(),s=r(6102);o.route("/").post(s.CreateRPOrder),o.route("/:id").post(s.PayOrder),e.exports=o},6102:(e,t,r)=>{r(9424),r(5724),r(3185);const o=r(4871),s=new o({key_id:"rzp_test_vmjtxiBj8VbrZj",key_secret:"lHAe6Qcnlcuriser6JICLjKt"});e.exports={CreateRPOrder:async(e,t)=>{console.log("CreateRPOrder of RP running..."),console.log("amount,currency,receipt,notes:"+e.body.amount+"-"+e.body.currency+"-"+e.body.receipt+"-"+e.body.notes);const{amount:r,currency:o,receipt:a,notes:n}=e.body;s.orders.create({amount:r,currency:o,receipt:a,notes:n},((e,o)=>{e?(console.log("error occured..."+e),t.send(e)):(console.log("no error rs:"+r),t.json(o))}))},PayOrder:async(e,t)=>{console.log("paying order now");var r={key_id:"rzp_test_vmjtxiBj8VbrZj",amount:e.body.amount,currency:"INR",name:"Dummy Academy",description:"Pay & Checkout this Course, Upgrade your DSA Skill",image:"https://media.geeksforgeeks.org/wp-content/uploads/20210806114908/dummy-200x200.png",order_id:e.params.id,handler:function(e){console.log(e),console.log("This step of Payment Succeeded")},prefill:{contact:"9780485123",name:"LoiusDesoza",email:"louisdesoza@gmail.com"},notes:{description:e.body.notes},theme:{color:"#2300a3"}},s=new o(r);console.log(s),s.on("payment.failed",(function(e){console.log(e),alert("This step of Payment Failed")}))}}},9666:(e,t,r)=>{var o=r(6860).Router(),s=r(4414);o.route("/:id?").get(s.Get_Parametric_Result),e.exports=o},4414:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185);e.exports={Get_Parametric_Result:async(e,t)=>{(async(e,t)=>{console.log("yes runned"),console.log(" req.query.mobileNumber:"+e.query.mobileNumber);const r=(await new o.ConnectionPool(s).connect()).request();var n="sp_checkareaconflict";try{r.input("mobileNumber",o.VarChar,e.query.mobileNumber),r.input("newsellerid",o.Int,e.query.newsellerid);var i=await r.execute(n);i.recordset[0]&&1===i.recordset[0][""]?t.status(200).json({conflict:!0}):t.status(200).json({conflict:!1})}catch(e){a.logError("sqlserver",n,e),t.status(500).json({conflict:!1})}})(e,t)}}},8315:(e,t,r)=>{var o=r(6860).Router(),s=r(8024);o.route("/:id?").get(s.get_Seller_Commission_Setting),o.route("/:id?").put(s.edit_Seller_Commission_Setting),e.exports=o},8024:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185);e.exports={get_Seller_Commission_Setting:async(e,t)=>{const r=(await new o.ConnectionPool(s).connect()).request();var n="sp_Seller_Commission_Setting_Get";try{e.params.id?r.input("sellerid",o.Int,e.params.id):r.input("id",o.Int,0);var i=await r.execute(n);t.status(200).json(i.recordset)}catch(e){a.logError("sqlserver",n,e),t.status(201).json({"sp_data:":null})}},edit_Seller_Commission_Setting:async(e,t)=>{console.log("m editing edit_Seller_Commission_Setting"),console.log("req.params.id:"+e.params.id),console.log("req.body:"+JSON.stringify(e.body));var r="sp_Seller_Commission_Setting_AddEdit";let n=await new o.ConnectionPool(s).connect();const i=await n.request();i.input("sellerid",o.VarChar,e.body.seller_id),i.input("commission_percent",o.VarChar(50),e.body.commission_percent),i.input("credit_limit",o.VarChar(50),e.body.credit_limit),i.input("RP_key",o.VarChar(100),e.body.RP_key);try{var d=await i.execute(r);t.status(200).json({"New Users:":d})}catch(e){a.logError("sqlserver",r,e),t.status(200).json({"New Users:":d})}},newProduct:(e,t)=>{console.log("Adding new product with req.body:"+JSON.stringify(e.body)+", sellerid:"+e.body.seller_id+"p name:"+e.body.product_name),new o.ConnectionPool(s).connect().then((r=>{const s=r.request();s.input("seller_id",o.Int,e.body.seller_id),s.input("product_name",o.VarChar,e.body.product_name),s.input("imageUrl",o.VarChar,e.body.imageUrl),s.execute("sp_Product_AddEdit",((e,r)=>{e&&(console.log("this is error"),t.status(401).json({"Error in SP sp_Product_AddEdit:":e})),console.log("result:"+e),t.status(200).json({"New Product:":"Added"})}))}))},newUsers:(e,t)=>{new o.ConnectionPool(s).connect().then((r=>{const s=r.request();s.input("ID",o.Int,e.body.userid),s.input("salutation",o.VarChar,e.body.salutation),s.input("Owner_Fname",o.VarChar,e.body.Owner_Fname),s.input("Owner_Lname",o.VarChar,e.body.Owner_Lname),s.input("FlatNo",o.Int,e.body.FlatNo),s.input("DP_base64",o.VarChar(50),e.body.DP_base64),s.execute("sp_Users_AddEdit",((e,r)=>{e&&(console.log("this is error"),t.status(401).json({"Error in SP sp_Register_CheckPermissionsOfDeviceid:":e})),console.log("result:"+e),t.status(200).json({"New Users:":"Added"})}))}))},editUsers:async(e,t)=>{var r,n="sp_Users_AddEdit";r=e.params.id?e.params.id:0,console.log("m here editing:salutation"+e.body.Owner_Lname);let i=await new o.ConnectionPool(s).connect();const d=await i.request();d.input("ID",o.Int,r),d.input("salutation",o.VarChar,e.body.salutation),d.input("Owner_Fname",o.VarChar(50),e.body.Owner_Fname),d.input("Owner_Lname",o.VarChar(50),e.body.Owner_Lname),d.input("FlatNo",o.Int,e.body.FlatNo),d.input("DP_base64",o.VarChar(50),e.body.DP_base64);try{var u=await d.execute(n);t.status(200).json({"New Users:":u})}catch(e){a.logError("sqlserver",n,e),t.status(200).json({"New Users:":u})}},deleteUsers:async(e,t)=>{var r,n="sp_Users_Delete";r=e.params.id?e.params.id:0,console.log("m here editing:salutation"+e.body.Owner_Lname);let i=await new o.ConnectionPool(s).connect();const d=await i.request();d.input("ID",o.Int,r);try{var u=await d.execute(n)}catch(e){a.logError("sqlserver",n,e),t.status(200).json({"New Users:":u})}}}},1792:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185);const n=r(7096);var i=async(e,t)=>{const r=(await new o.ConnectionPool(s).connect()).request();var n="sp_Users_Get";try{return r.input("ID",o.Int,0),(await r.execute(n)).recordset}catch(e){a.logError("sqlserver",n,e),t.status(201).json({"sp_data:":null})}};e.exports={AuthenticateAndReturnRole:async(e,t,r,o)=>{var s;return null==(s=await i()).find((e=>e.userid==r))?null:await s.find((e=>e.userid==r&&e.password==o))},FindDeviceAndReturnUser:async(e,t,r)=>{var o;return null==(o=await i(0,t)).find((e=>e.deviceid==r&&0==e.access_saturated))||null==o.find((e=>e.deviceid==r&&0==e.deviceaccess_saturated))?null:await o.find((e=>e.deviceid==r))},FindCredentialAndReturnUser:async(e,t,r,o)=>{var s;return console.log("findinguser "),console.log("with passwordvlength:"+o.length),null==(s=await i(0,t)).find((e=>e.userid==r&&1==e.IsActive))?null:4==o.length?(console.log("searching in userExtra"),console.log("usercount:"+s.length),await s.find((e=>e.userid==r&&e.otpfromsupplier==o&&1==e.IsActive))):await s.find((e=>e.userid==r&&n.compareSync(o,e.password)&&1==e.IsActive))}}},8380:(e,t,r)=>{var o=r(6860).Router(),s=r(2114);o.route("/:id").post(s.sendotpORregister),e.exports=o},2114:(e,t,r)=>{var o=r(9424),s=r(5724);const a=r(7096);var n=r(3185);r(9701),r(4636),r(3685);var i=async(e,t)=>{const{obj:r}=e.body,i=a.genSaltSync(10),d=a.hashSync(r.password,i);var u="sp_UserMgt_AddEdit";const c=(await new o.ConnectionPool(s).connect()).request();c.input("id",o.Int,r.id),c.input("userid",o.VarChar,r.userid),c.input("display_name",o.VarChar,r.display_name),c.input("password",o.VarChar,d),c.input("userrole",o.VarChar,r.userrole),c.input("firm_name",o.VarChar,""),c.input("firm_addr",o.VarChar,""),c.input("shop_type",o.VarChar,""),c.input("IsActive",o.Bit,r.IsActive),c.input("CREATEDBY_username",o.VarChar,"self"),c.input("supplier_id",o.Int,0);try{var l=await c.execute(u);t.status(200).json({sp_data:l.recordset})}catch(e){n.logError("sqlserver",u,e),t.status(200).json({sp_data:null})}};e.exports={sendotpORregister:async(e,t)=>{"sendotp"==e.params.id?(async(e,t)=>{const{obj:o}=e.body;console.log("trying fats2sms npm..............."),console.log("to mobile:"+o.mobileNumber);const s=r(382);var a=Math.floor(1e3+9e3*Math.random()).toString();console.log("otp_generated:"+a);var n={authorization:"HKgCIgvaSDRbJBJREPT7MYPzcMKlkcQMU3AoAI960q44FzEhQatq6WOqPI0U",message:a,numbers:[o.mobileNumber]};process.env.DEBUG=!0,s.sendMessage(n).then((e=>{console.log("response:"),console.log(e),t.json({success:!0,message:"OTP sent to new customer to sign in",otp_which_sent_to_customer:a})})).catch((e=>{console.log("error occured:"),console.error(e)})),t.json({success:!0,message:"OTP sent to new customer to sign in",otp_which_sent_to_customer:a})})(e,t):"register"==e.params.id&&i(e,t)},EditUser:i}},761:(e,t,r)=>{var o=r(6860).Router(),s=r(7988);o.route("/:id?").get(s.getUnitMaster),e.exports=o},7988:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185);e.exports={getUnitMaster:async(e,t)=>{const r=(await new o.ConnectionPool(s).connect()).request();var n="sp_Unitmaster_Get";try{e.params.id?r.input("id",o.Int,e.params.id):r.input("id",o.Int,0);var i=await r.execute(n);t.status(200).json(i.recordset)}catch(e){a.logError("sqlserver",n,e),t.status(201).json({"sp_data:":null})}}}},5993:(e,t,r)=>{var o=r(6860).Router(),s=r(3933);o.route("/:id").post(s.upload.single("icon"),s.uploadSingleImage),o.route("/:id").delete(s.uploadSingleImage),e.exports=o},3933:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185),n=r(1738);r(1017);const i=n.diskStorage({destination:(e,t,o)=>{var s=r(7147),a="./images";s.existsSync(a)||s.mkdirSync(a),o(null,"./images")},filename:(e,t,r)=>{console.log("file.originalname:"+t.originalname),r(null,t.originalname)}});t.upload=n({storage:i,fileFilter:(e,t,r)=>{if(!t.originalname.match(/\.(png|jpg|jpeg)$/))return r(new Error("Please upload a Image"));r(null,!0)}}),t.uploadSingleImage=async(e,t)=>{console.log("req.body.OP:"+JSON.stringify(e.body.OP)),console.log("req.file.filename:"+e.file.filename);var o=r(7147),s=o.readFileSync("./images/"+e.file.filename,"base64");setTimeout((()=>{var t="./images/"+e.file.filename;o.unlinkSync(t)}),3e4),"DPuploading"==e.query.Operation?d(e,t,s,e.file.filename):"attchmentuploading"==e.body.OP?(console.log("m attching image now..."),u(e,t,s)):"attchmentdeleting"==e.query.OP&&c(e,t,s)};var d=async(e,t,r,n)=>{var i="sp_upload_DP_Owner";let d=await new o.ConnectionPool(s).connect();const u=await d.request();try{u.input("OwnersID",o.Int,parseInt(e.params.id)),u.input("DP_base64",o.VarChar,"data:image/jpeg;base64,"+r),u.input("CREATEDBY_username",o.VarChar,"CREATEDBY_username"),await u.execute(i),t.status(200).json({statusCode:200,status:!0,message:"Image added",data:[]})}catch(e){a.logError("sqlserver",i,e),t.status(200).json({sp_data:null})}},u=async(e,t,r)=>{console.log("uploadAAttachment is on....");var n="sp_uploadImage";let i=await new o.ConnectionPool(s).connect();const d=await i.request();try{d.input("ID",o.Int,e.params.id),d.input("Imagebase64",o.VarChar,r),d.input("Imagename",o.VarChar,e.body.imagename),d.input("isDeleted",o.Int,e.body.isDeleted),d.input("CREATEDBY_username",o.VarChar,JSON.stringify(e.body.username)),await d.execute(n),console.log(e.query.imagename+" with ID:"+e.params.id+" and with imagename:"+e.body.imagename+"req.body.isDeleted:"+e.body.isDeleted+" is created in DB................................................................"),t.status(200).json({statusCode:200,status:!0,message:"Image added",data:[]})}catch(e){a.logError("sqlserver",n,e),t.status(200).json({sp_data:null})}},c=async(e,t,r)=>{console.log("deleteAAttachment is on....");var n="sp_uploadImage_delete";let i=await new o.ConnectionPool(s).connect();const d=await i.request();try{d.input("ID",o.Int,e.params.id),d.input("Imagename",o.VarChar,e.query.imagename),d.input("isDeleted",o.Int,e.query.isDeleted),d.input("CREATEDBY_username",o.VarChar,e.query.username),await d.execute(n),console.log(e.query.imagename+" with ID:"+e.params.id+"req.query.isDeleted:"+e.query.isDeleted+" is created in DB................................................................"),t.status(200).json({statusCode:200,status:!0,message:"Image added",data:[]})}catch(e){a.logError("sqlserver",n,e),t.status(200).json({sp_data:null})}};t.uploadMultipleImage=async(e,t)=>{for(var r=0;r<e.files.length;r++)await client.query(`INSERT INTO users(name, icon) VALUES ('${e.body.name}','${e.files[r].filename}')`);t.status(200).json({statusCode:200,status:!0,message:"All Image added",data:[]})}},7887:(e,t,r)=>{var o=r(6860).Router(),s=r(9701);o.route("/:id/:role/:userIDs/:mobileNumber?/:PageNumber?/:PageSize?/:seller_id?").get(s.getUsers),o.route("/:id?").put(s.EditUser),o.route("/:id").delete(s.DeleteUser),e.exports=o},9701:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185);const n=r(7096);e.exports={getUsers:async(e,t)=>{console.log("req.params.role:"+e.params.role);var r="sp_Users_Get";const n=(await new o.ConnectionPool(s).connect()).request();n.input("ID",o.Int,e.params.id),n.input("role",o.VarChar,e.params.role),n.input("userIDs",o.VarChar,e.params.userIDs),e.params.PageNumber&&n.input("PageNumber",o.Int,e.params.PageNumber),e.params.PageSize&&n.input("PageSize",o.Int,e.params.PageSize),e.params.seller_id&&n.input("seller_id",o.Int,e.params.seller_id),e.params.mobileNumber&&n.input("mobileNumber",o.VarChar,e.params.mobileNumber);try{var i=await n.execute(r);t.status(200).json(i.recordset)}catch(e){a.logError("sqlserver",r,e),t.status(500).json({Number:e.number,Message:e.message})}},EditUser:async(e,t)=>{console.log("req.body.shop_type:"+e.body.shop_type);var r=0;null==e.params.id?r=0:(r=e.params.id,console.log("req.params.id:"+e.params.id)),console.log("req.body.password"+e.body.password);var i="";if(0==e.params.id){const t=10,r=n.genSaltSync(t);e.body.password=n.hashSync(e.body.password,r)}else if("NotEditing*123"!=e.body.password){const r=e.body.oldpassword;console.log("get thisusers data");var d=await(async e=>{const t=(await new o.ConnectionPool(s).connect()).request();t.input("ID",o.Int,e);var r=await t.execute("sp_Users_Get");return console.log("old password is:"+JSON.stringify(r.recordsets[0][0].password)),r.recordsets[0][0].password})(e.body.id);console.log("retrieved oldhashedPassword:"+d);const a=n.compareSync(r,d);a?console.log("old password matches"):console.log("not matching old password....");const u=e.body.password,c=10,l=n.genSaltSync(c);if(i=n.hashSync(u,l),!a&&"iamadmin"!=e.body.oldpassword)return console.log("i cannot change current password"),e.body.password="NotEditing*123",t.status(500).json({message:"Could not change password"});e.body.password=i}var u="sp_UserMgt_AddEdit";const c=(await new o.ConnectionPool(s).connect()).request();c.input("id",o.Int,r),c.input("userid",o.VarChar,e.body.userid),c.input("display_name",o.VarChar,e.body.display_name),c.input("password",o.VarChar,e.body.password),c.input("userrole",o.VarChar,e.body.userrole),c.input("firm_name",o.VarChar,e.body.firm_name),c.input("firm_addr",o.VarChar,e.body.firm_addr),c.input("shop_type",o.VarChar,e.body.shop_type),c.input("IsActive",o.Bit,e.body.IsActive),c.input("CREATEDBY_username",o.VarChar,e.body.CREATEDBY_username),c.input("supplier_id",o.Int,e.body.supplier_id),c.input("area_code",o.VarChar,e.body.area_code);try{var l=await c.execute(u);t.status(200).json({sp_data:l.recordset})}catch(e){a.logError("sqlserver",u,e),t.status(500).json({Number:e.number,Message:e.message})}},DeleteUser:async(e,t)=>{console.log("u r about to delete user.......with id:"+e.params.id);var r="sp_UserMgt_Delete";const n=(await new o.ConnectionPool(s).connect()).request();n.input("ID",o.Int,e.params.id);try{var i=await n.execute(r);t.status(200).json({sp_data:i.recordset})}catch(e){a.logError("sqlserver",r,e),t.status(500).json({Number:e.number,Message:e.message})}}}},527:(e,t,r)=>{var o=r(6860).Router(),s=r(2245);o.route("/:id/:from_userExtra?/:approval_status?/:seller_id?").get(s.Get_Consumer),o.route("/:id?").put(s.RegisterOrRequest),o.route("/").post(s.New_Consumer),e.exports=o},2245:(e,t,r)=>{var o=r(9424),s=r(5724),a=r(3185);const n=r(7096);e.exports={Get_Consumer:async(e,t)=>{console.log("req.params.mobileNumber:"+e.params.id),console.log("req.params.from_userExtra:"+e.params.from_userExtra),console.log("req.params.approval_status:"+e.params.approval_status),console.log("req.params.seller_id:"+e.params.seller_id);var r="sp_UsersExtra_Get";const n=(await new o.ConnectionPool(s).connect()).request();e.params.id&&(console.log("param added id:"+e.params.id),n.input("mobileNumber",o.VarChar,e.params.id)),e.params.from_userExtra&&(console.log("param added from_userExtra:"+e.params.from_userExtra),n.input("from_userExtra",o.Int,e.params.from_userExtra)),e.params.approval_status&&(console.log("param added approval_status zero:"+e.params.approval_status),n.input("approval_status",o.VarChar,e.params.approval_status)),e.params.seller_id&&(console.log("param added seller_id:"+e.params.seller_id),n.input("seller_id",o.Int,e.params.seller_id));try{var i=await n.execute(r);console.log("userextra get:"+JSON.stringify(i.recordset)),t.status(200).json(i.recordset)}catch(e){a.logError("sqlserver",r,e),t.status(500).json({Number:e.number,Message:e.message})}},New_Consumer:async(e,t)=>{console.log("m trying to add new consumer"),console.log("req.body.mobileNumber:"+e.body.mobileNumber),console.log("req.body.seller_id:"+e.body.seller_id);var r="sp_New_Consumer";const n=(await new o.ConnectionPool(s).connect()).request();n.input("mobileNumber",o.VarChar,e.body.mobileNumber),n.input("seller_id",o.Int,e.body.seller_id),n.input("otpfromsupplier",o.VarChar,e.body.otpfromsupplier);try{var i=await n.execute(r);t.status(200).json({sp_data:i.recordset})}catch(e){a.logError("sqlserver",r,e),t.status(500).json({Number:e.number,Message:e.message})}},RegisterOrRequest:async(e,t)=>{console.log("req.body:"+JSON.stringify(e.body)),"register_request"==e.body.action?(console.log("m for consumer to requesting a registration"),(async(e,t)=>{var r="sp_New_Consumer_Registration_requestORapprove";const i=(await new o.ConnectionPool(s).connect()).request();console.log("mhashing password:"+e.body.password);const d=n.genSaltSync(10);e.body.password=n.hashSync(e.body.password,d),i.input("mobileNumber",o.VarChar,e.body.mobileNumber),i.input("display_name",o.VarChar,e.body.display_name),i.input("consumer_address",o.VarChar,e.body.consumer_address),i.input("password",o.VarChar,e.body.password),i.input("action",o.VarChar,e.body.action);try{var u=await i.execute(r);t.status(200).json({sp_data:u.recordset})}catch(e){a.logError("sqlserver",r,e),t.status(200).json({sp_data:null})}})(e,t)):"register_request_approve"==e.body.action&&(console.log("m ready to approve new consumer"),console.log("req.body:"+JSON.stringify(e.body)),(async(e,t)=>{var r="sp_New_Consumer_Registration_requestORapprove";const n=(await new o.ConnectionPool(s).connect()).request();n.input("mobileNumber",o.VarChar,e.body.mobileNumber),n.input("seller_id",o.VarChar,e.body.seller_id),n.input("approval_status",o.VarChar,e.body.approval_status),n.input("action",o.VarChar,e.body.action);try{var i=await n.execute(r);t.status(200).json({sp_data:i.recordset})}catch(e){a.logError("sqlserver",r,e),t.status(500).json({Number:e.number,Message:e.message})}})(e,t))}}},9347:(e,t,r)=>{var o=r(9424),s=r(5724);const a=new o.ConnectionPool(s);e.exports={existsOrnot_Productforid:async e=>{try{return await a.connect(),0!=(await a.request().input("productId",o.Int,e).query("SELECT count(*) productCount FROM Products WHERE id = @productId")).recordset[0].productCount}catch(e){console.log(e)}finally{a.close()}},return_CartIDforuserid:async e=>{try{return await a.connect(),(await a.request().input("userId",o.Int,e).query("SELECT id usercartId FROM Carts WHERE userId = @userId")).recordset[0].usercartId}catch(e){console.log(e)}finally{a.close()}}}},3185:(e,t,r)=>{var o=r(9424),s=r(5724);new o.ConnectionPool(s),e.exports={logError:async(e,t,r)=>{console.log("This is logError type"+e+"  ,objectname:"+t+" , Description:"+r);const a=(await new o.ConnectionPool(s).connect()).request();try{a.input("error_Type",o.VarChar,e),a.input("Error_Object",o.VarChar,t),a.input("error_Description",o.VarChar,r),await a.execute("sp_ErrorLog")}catch(e){console.log("logerror itself is having error")}}}},4636:e=>{e.exports={port:3051}},7096:e=>{"use strict";e.exports=require("bcrypt")},3986:e=>{"use strict";e.exports=require("body-parser")},3582:e=>{"use strict";e.exports=require("cors")},6860:e=>{"use strict";e.exports=require("express")},382:e=>{"use strict";e.exports=require("fast-two-sms")},9344:e=>{"use strict";e.exports=require("jsonwebtoken")},8982:e=>{"use strict";e.exports=require("moment")},9424:e=>{"use strict";e.exports=require("mssql")},1738:e=>{"use strict";e.exports=require("multer")},4871:e=>{"use strict";e.exports=require("razorpay")},3453:e=>{"use strict";e.exports=require("store2")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},1017:e=>{"use strict";e.exports=require("path")},7282:e=>{"use strict";e.exports=require("process")}},t={};function r(o){var s=t[o];if(void 0!==s)return s.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,r),a.exports}(()=>{r(3857);const e=r(6860),t=e(),o=r(4636),s=r(3582),a=r(3986),n=r(7282);t.use("*",s()),t.use(a.urlencoded({extended:!0})),t.use(a.json()),t.use(e.json());const i=n.env.PORT||o.port;loginC=r(1955),t.use("/api/login",loginC),usermgtC=r(7887),t.use("/api/Usermgt",usermgtC),usermgtExtraC=r(527),t.use("/api/UsermgtExtra",usermgtExtraC),productC=r(5800),t.use("/api/product",productC),categoryC=r(9122),t.use("/api/category",categoryC),cartC=r(957),t.use("/api/cart",cartC),orderC=r(9757),t.use("/api/order",orderC),ordercommissionC=r(4190),t.use("/api/ordercommission",ordercommissionC),sellercommissionC=r(8315),t.use("/api/sellercommission",sellercommissionC),sellerAreaC=r(9666),t.use("/api/sellerarea",sellerAreaC),parameterC=r(5966),t.use("/api/parameter",parameterC),orderitemC=r(2349),t.use("/api/orderitem",orderitemC),promotionmastC=r(2878),t.use("/api/promotionmast",promotionmastC),PromotionProductC=r(4435),t.use("/api/promotionproduct",PromotionProductC),PromotionQuantityC=r(4266),t.use("/api/promotionQuantity",PromotionQuantityC),PromotionOrderC=r(4448),t.use("/api/promotionorder",PromotionOrderC),uploadImage_multerC=r(5993),t.use("/api/uploadImage_multer",uploadImage_multerC),errorC=r(262),t.use("/api/ErrorLog",errorC),razorC=r(1494),t.use("/api/Razor",razorC),otpC=r(8380),t.use("/api/sendotpORregister",otpC),unitmgtC=r(761),t.use("/api/unitmgt",unitmgtC),prod_quality_optionC=r(6538),t.use("/api/prod_quality",prod_quality_optionC),t.listen(i,(()=>console.log(`Server started on port ${i}`)))})()})();